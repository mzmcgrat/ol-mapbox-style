"use strict";(self.webpackChunkol_mapbox_style=self.webpackChunkol_mapbox_style||[]).push([[497],{3504:(e,t,r)=>{r(8508);var n=Math.pow,i=(e,t,r)=>new Promise(((n,i)=>{var o=e=>{try{a(r.next(e))}catch(e){i(e)}},s=e=>{try{a(r.throw(e))}catch(e){i(e)}},a=e=>e.done?n(e.value):Promise.resolve(e.value).then(o,s);a((r=r.apply(e,t)).next())})),o=Uint8Array,s=Uint16Array,a=Int32Array,c=new o([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),l=new o([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),u=new o([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),f=function(e,t){for(var r=new s(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];var i=new a(r[30]);for(n=1;n<30;++n)for(var o=r[n];o<r[n+1];++o)i[o]=o-r[n]<<5|n;return{b:r,r:i}},h=f(c,2),d=h.b,g=h.r;d[28]=258,g[258]=28;var y,m=f(l,0),p=m.b,w=(m.r,new s(32768));for(x=0;x<32768;++x)y=(61680&(y=(52428&(y=(43690&x)>>1|(21845&x)<<1))>>2|(13107&y)<<2))>>4|(3855&y)<<4,w[x]=((65280&y)>>8|(255&y)<<8)>>1;var v=function(e,t,r){for(var n=e.length,i=0,o=new s(t);i<n;++i)e[i]&&++o[e[i]-1];var a,c=new s(t);for(i=1;i<t;++i)c[i]=c[i-1]+o[i-1]<<1;if(r){a=new s(1<<t);var l=15-t;for(i=0;i<n;++i)if(e[i])for(var u=i<<4|e[i],f=t-e[i],h=c[e[i]-1]++<<f,d=h|(1<<f)-1;h<=d;++h)a[w[h]>>l]=u}else for(a=new s(n),i=0;i<n;++i)e[i]&&(a[i]=w[c[e[i]-1]++]>>15-e[i]);return a},b=new o(288);for(x=0;x<144;++x)b[x]=8;for(x=144;x<256;++x)b[x]=9;for(x=256;x<280;++x)b[x]=7;for(x=280;x<288;++x)b[x]=8;var x,D=new o(32);for(x=0;x<32;++x)D[x]=5;var U=v(b,9,1),L=v(D,5,1),T=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},z=function(e,t,r){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(7&t)&r},C=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&t)},E=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],M=function(e,t,r){var n=new Error(t||E[e]);if(n.code=e,Error.captureStackTrace&&Error.captureStackTrace(n,M),!r)throw n;return n},A=function(e,t,r,n){var i=e.length,s=n?n.length:0;if(!i||t.f&&!t.l)return r||new o(0);var a=!r||2!=t.i,f=t.i;r||(r=new o(3*i));var h=function(e){var t=r.length;if(e>t){var n=new o(Math.max(2*t,e));n.set(r),r=n}},g=t.f||0,y=t.p||0,m=t.b||0,w=t.l,b=t.d,x=t.m,D=t.n,E=8*i;do{if(!w){g=z(e,y,1);var A=z(e,y+1,3);if(y+=3,!A){var O=e[(I=4+((y+7)/8|0))-4]|e[I-3]<<8,$=I+O;if($>i){f&&M(0);break}a&&h(m+O),r.set(e.subarray(I,$),m),t.b=m+=O,t.p=y=8*$,t.f=g;continue}if(1==A)w=U,b=L,x=9,D=5;else if(2==A){var B=z(e,y,31)+257,k=z(e,y+10,15)+4,Z=B+z(e,y+5,31)+1;y+=14;for(var V=new o(Z),H=new o(19),P=0;P<k;++P)H[u[P]]=z(e,y+3*P,7);y+=3*k;var R=T(H),j=(1<<R)-1,S=v(H,R,1);for(P=0;P<Z;){var I,N=S[z(e,y,j)];if(y+=15&N,(I=N>>4)<16)V[P++]=I;else{var W=0,K=0;for(16==I?(K=3+z(e,y,3),y+=2,W=V[P-1]):17==I?(K=3+z(e,y,7),y+=3):18==I&&(K=11+z(e,y,127),y+=7);K--;)V[P++]=W}}var _=V.subarray(0,B),J=V.subarray(B);x=T(_),D=T(J),w=v(_,x,1),b=v(J,D,1)}else M(1);if(y>E){f&&M(0);break}}a&&h(m+131072);for(var F=(1<<x)-1,q=(1<<D)-1,G=y;;G=y){var Q=(W=w[C(e,y)&F])>>4;if((y+=15&W)>E){f&&M(0);break}if(W||M(2),Q<256)r[m++]=Q;else{if(256==Q){G=y,w=null;break}var X=Q-254;if(Q>264){var Y=c[P=Q-257];X=z(e,y,(1<<Y)-1)+d[P],y+=Y}var ee=b[C(e,y)&q],te=ee>>4;if(ee||M(3),y+=15&ee,J=p[te],te>3&&(Y=l[te],J+=C(e,y)&(1<<Y)-1,y+=Y),y>E){f&&M(0);break}a&&h(m+131072);var re=m+X;if(m<J){var ne=s-J,ie=Math.min(J,re);for(ne+m<0&&M(3);m<ie;++m)r[m]=n[ne+m]}for(;m<re;m+=4)r[m]=r[m-J],r[m+1]=r[m+1-J],r[m+2]=r[m+2-J],r[m+3]=r[m+3-J];m=re}}t.l=w,t.p=G,t.b=m,t.f=g,w&&(g=1,t.m=x,t.d=b,t.n=D)}while(!g);return m==r.length?r:function(e,t,r){(null==t||t<0)&&(t=0),(null==r||r>e.length)&&(r=e.length);var n=new o(r-t);return n.set(e.subarray(t,r)),n}(r,0,m)},O=new o(0),$=function(e){31==e[0]&&139==e[1]&&8==e[2]||M(6,"invalid gzip data");var t=e[3],r=10;4&t&&(r+=2+(e[10]|e[11]<<8));for(var n=(t>>3&1)+(t>>4&1);n>0;n-=!e[r++]);return r+(2&t)},B=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0},k=function(e,t){return(8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31)&&M(6,"invalid zlib data"),(e[1]>>5&1)==+!t&&M(6,"invalid zlib data: "+(32&e[1]?"need":"unexpected")+" dictionary"),2+(e[1]>>3&4)};function Z(e,t){return 31==e[0]&&139==e[1]&&8==e[2]?function(e,t){var r=$(e);return r+8>e.length&&M(6,"invalid gzip data"),A(e.subarray(r,-8),{i:2},t&&t.out||new o(B(e)),t&&t.dictionary)}(e,t):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?function(e,t){return A(e,{i:2},t&&t.out,t&&t.dictionary)}(e,t):function(e,t){return A(e.subarray(k(e,t&&t.dictionary),-4),{i:2},t&&t.out,t&&t.dictionary)}(e,t)}var V="undefined"!=typeof TextDecoder&&new TextDecoder;try{V.decode(O,{stream:!0})}catch(e){}var H=(e,t)=>e*n(2,t),P=(e,t)=>Math.floor(e/n(2,t)),R=(e,t)=>H(e.getUint16(t+1,!0),8)+e.getUint8(t),j=(e,t)=>H(e.getUint32(t+2,!0),16)+e.getUint16(t,!0),S=(e,t,r,n,i)=>{if(e!==n.getUint8(i))return e-n.getUint8(i);const o=R(n,i+1);if(t!==o)return t-o;const s=R(n,i+4);return r!==s?r-s:0},I=(e,t,r,n)=>{const i=N(e,t,r,n);return i?{z:t,x:r,y:n,offset:i[0],length:i[1],isDir:!1}:null},N=(e,t,r,n)=>{let i=0,o=e.byteLength/17-1;for(;i<=o;){const s=o+i>>1,a=S(t,r,n,e,17*s);if(a>0)i=s+1;else{if(!(a<0))return[j(e,17*s+7),e.getUint32(17*s+13,!0)];o=s-1}}return null},W=(e,t)=>e.isDir&&!t.isDir?1:!e.isDir&&t.isDir?-1:e.z!==t.z?e.z-t.z:e.x!==t.x?e.x-t.x:e.y-t.y,K=(e,t)=>{const r=e.getUint8(17*t);return{z:127&r,x:R(e,17*t+1),y:R(e,17*t+4),offset:j(e,17*t+7),length:e.getUint32(17*t+13,!0),isDir:r>>7==1}},_=e=>{const t=[],r=new DataView(e);for(let e=0;e<r.byteLength/17;e++)t.push(K(r,e));return J(t)},J=e=>{e.sort(W);const t=new ArrayBuffer(17*e.length),r=new Uint8Array(t);for(let t=0;t<e.length;t++){const n=e[t];let i=n.z;n.isDir&&(i|=128),r[17*t]=i,r[17*t+1]=255&n.x,r[17*t+2]=n.x>>8&255,r[17*t+3]=n.x>>16&255,r[17*t+4]=255&n.y,r[17*t+5]=n.y>>8&255,r[17*t+6]=n.y>>16&255,r[17*t+7]=255&n.offset,r[17*t+8]=255&P(n.offset,8),r[17*t+9]=255&P(n.offset,16),r[17*t+10]=255&P(n.offset,24),r[17*t+11]=255&P(n.offset,32),r[17*t+12]=255&P(n.offset,48),r[17*t+13]=255&n.length,r[17*t+14]=n.length>>8&255,r[17*t+15]=n.length>>16&255,r[17*t+16]=n.length>>24&255}return t},F={getHeader:function(e){return i(this,null,(function*(){const t=yield e.getBytes(0,512e3),r=new DataView(t.data),n=r.getUint32(4,!0),i=r.getUint16(8,!0),o=new TextDecoder("utf-8"),s=JSON.parse(o.decode(new DataView(t.data,10,n)));let a=0;"gzip"===s.compression&&(a=2);let c=0;"minzoom"in s&&(c=+s.minzoom);let l=0;"maxzoom"in s&&(l=+s.maxzoom);let u=0,f=0,h=0,d=-180,g=-85,y=180,m=85;if(s.bounds){const e=s.bounds.split(",");d=+e[0],g=+e[1],y=+e[2],m=+e[3]}if(s.center){const e=s.center.split(",");u=+e[0],f=+e[1],h=+e[2]}return{specVersion:r.getUint16(2,!0),rootDirectoryOffset:10+n,rootDirectoryLength:17*i,jsonMetadataOffset:10,jsonMetadataLength:n,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:a,tileType:1,minZoom:c,maxZoom:l,minLon:d,minLat:g,maxLon:y,maxLat:m,centerZoom:h,centerLon:u,centerLat:f,etag:t.etag}}))},getZxy:function(e,t,r,n,o,s,a){return i(this,null,(function*(){let i=yield r.getArrayBuffer(t,e.rootDirectoryOffset,e.rootDirectoryLength,e);1===e.specVersion&&(i=_(i));const c=I(new DataView(i),n,o,s);if(c){let e=(yield t.getBytes(c.offset,c.length,a)).data;const r=new DataView(e);return 31===r.getUint8(0)&&139===r.getUint8(1)&&(e=Z(new Uint8Array(e))),{data:e}}const l=((e,t)=>{if(e.byteLength<17)return null;const r=e.byteLength/17,n=K(e,r-1);if(n.isDir){const e=n.z,r=t.z-e;return{z:e,x:Math.trunc(t.x/(1<<r)),y:Math.trunc(t.y/(1<<r))}}return null})(new DataView(i),{z:n,x:o,y:s});if(l){const c=((e,t,r,n)=>{const i=N(e,128|t,r,n);return i?{z:t,x:r,y:n,offset:i[0],length:i[1],isDir:!0}:null})(new DataView(i),l.z,l.x,l.y);if(c){let i=yield r.getArrayBuffer(t,c.offset,c.length,e);1===e.specVersion&&(i=_(i));const l=I(new DataView(i),n,o,s);if(l){let e=(yield t.getBytes(l.offset,l.length,a)).data;const r=new DataView(e);return 31===r.getUint8(0)&&139===r.getUint8(1)&&(e=Z(new Uint8Array(e))),{data:e}}}}}))}};function q(e,t){return 4294967296*(t>>>0)+(e>>>0)}function G(e){const t=e.buf;let r=t[e.pos++],n=127&r;return r<128?n:(r=t[e.pos++],n|=(127&r)<<7,r<128?n:(r=t[e.pos++],n|=(127&r)<<14,r<128?n:(r=t[e.pos++],n|=(127&r)<<21,r<128?n:(r=t[e.pos],n|=(15&r)<<28,function(e,t){const r=t.buf;let n=r[t.pos++],i=(112&n)>>4;if(n<128)return q(e,i);if(n=r[t.pos++],i|=(127&n)<<3,n<128)return q(e,i);if(n=r[t.pos++],i|=(127&n)<<10,n<128)return q(e,i);if(n=r[t.pos++],i|=(127&n)<<17,n<128)return q(e,i);if(n=r[t.pos++],i|=(127&n)<<24,n<128)return q(e,i);if(n=r[t.pos++],i|=(1&n)<<31,n<128)return q(e,i);throw new Error("Expected varint not more than 10 bytes")}(n,e)))))}function Q(e,t,r,n){if(0===n){1===r&&(t[0]=e-1-t[0],t[1]=e-1-t[1]);const n=t[0];t[0]=t[1],t[1]=n}}var X=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function Y(e,t){return i(this,null,(function*(){if(1===t||0===t)return e;if(2===t){if(void 0===globalThis.DecompressionStream)return Z(new Uint8Array(e));const t=new Response(e).body;if(!t)throw Error("Failed to read response stream");const r=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(r).arrayBuffer()}throw Error("Compression method not supported")}))}function ee(e,t){let r=0,n=e.length-1;for(;r<=n;){const i=n+r>>1,o=t-e[i].tileId;if(o>0)r=i+1;else{if(!(o<0))return e[i];n=i-1}}if(n>=0){if(0===e[n].runLength)return e[n];if(t-e[n].tileId<e[n].runLength)return e[n]}return null}var te=class{constructor(e,t=new Headers){this.url=e,this.customHeaders=t,this.mustReload=!1;let r="";"navigator"in globalThis&&(r=globalThis.navigator.userAgent||"");const n=r.indexOf("Windows")>-1,i=/Chrome|Chromium|Edg|OPR|Brave/.test(r);this.chromeWindowsNoCache=!1,n&&i&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(e){this.customHeaders=e}getBytes(e,t,r,n){return i(this,null,(function*(){let i,o;r?o=r:(i=new AbortController,o=i.signal);const s=new Headers(this.customHeaders);let a;s.set("range",`bytes=${e}-${e+t-1}`),this.mustReload?a="reload":this.chromeWindowsNoCache&&(a="no-store");let c=yield fetch(this.url,{signal:o,cache:a,headers:s});if(0===e&&416===c.status){const e=c.headers.get("Content-Range");if(!e||!e.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const t=+e.substr(8);c=yield fetch(this.url,{signal:o,cache:"reload",headers:{range:"bytes=0-"+(t-1)}})}let l=c.headers.get("Etag");if((null==l?void 0:l.startsWith("W/"))&&(l=null),416===c.status||n&&l&&l!==n)throw this.mustReload=!0,new ie(`Server returned non-matching ETag ${n} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(c.status>=300)throw Error(`Bad response code: ${c.status}`);const u=c.headers.get("Content-Length");if(200===c.status&&(!u||+u>t))throw i&&i.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield c.arrayBuffer(),etag:l||void 0,cacheControl:c.headers.get("Cache-Control")||void 0,expires:c.headers.get("Expires")||void 0}}))}};function re(e,t){const r=e.getUint32(t+4,!0),i=e.getUint32(t+0,!0);return r*n(2,32)+i}function ne(e){const t={buf:new Uint8Array(e),pos:0},r=G(t),n=[];let i=0;for(let e=0;e<r;e++){const e=G(t);n.push({tileId:i+e,offset:0,length:0,runLength:1}),i+=e}for(let e=0;e<r;e++)n[e].runLength=G(t);for(let e=0;e<r;e++)n[e].length=G(t);for(let e=0;e<r;e++){const r=G(t);n[e].offset=0===r&&e>0?n[e-1].offset+n[e-1].length:r-1}return n}var ie=class extends Error{};var oe=class{constructor(e=100,t=!0,r=Y){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=r}getHeader(e){return i(this,null,(function*(){const t=e.getKey(),r=this.cache.get(t);if(r)return r.lastUsed=this.counter++,yield r.data;const n=new Promise(((t,r)=>{(function(e,t){return i(this,null,(function*(){const r=yield e.getBytes(0,16384);if(19792!==new DataView(r.data).getUint16(0,!0))throw new Error("Wrong magic number for PMTiles archive");if(function(e){const t=new DataView(e);return 2===t.getUint16(2,!0)?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):1===t.getUint16(2,!0)?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}(r.data)<3)return[yield F.getHeader(e)];const n=function(e,t){const r=new DataView(e),n=r.getUint8(7);if(n>3)throw Error(`Archive is spec version ${n} but this library supports up to spec version 3`);return{specVersion:n,rootDirectoryOffset:re(r,8),rootDirectoryLength:re(r,16),jsonMetadataOffset:re(r,24),jsonMetadataLength:re(r,32),leafDirectoryOffset:re(r,40),leafDirectoryLength:re(r,48),tileDataOffset:re(r,56),tileDataLength:re(r,64),numAddressedTiles:re(r,72),numTileEntries:re(r,80),numTileContents:re(r,88),clustered:1===r.getUint8(96),internalCompression:r.getUint8(97),tileCompression:r.getUint8(98),tileType:r.getUint8(99),minZoom:r.getUint8(100),maxZoom:r.getUint8(101),minLon:r.getInt32(102,!0)/1e7,minLat:r.getInt32(106,!0)/1e7,maxLon:r.getInt32(110,!0)/1e7,maxLat:r.getInt32(114,!0)/1e7,centerZoom:r.getUint8(118),centerLon:r.getInt32(119,!0)/1e7,centerLat:r.getInt32(123,!0)/1e7,etag:t}}(r.data.slice(0,127),r.etag),i=r.data.slice(n.rootDirectoryOffset,n.rootDirectoryOffset+n.rootDirectoryLength),o=`${e.getKey()}|${n.etag||""}|${n.rootDirectoryOffset}|${n.rootDirectoryLength}`,s=ne(yield t(i,n.internalCompression));return[n,[o,s.length,s]]}))})(e,this.decompress).then((e=>{e[1]&&this.cache.set(e[1][0],{lastUsed:this.counter++,data:Promise.resolve(e[1][2])}),t(e[0]),this.prune()})).catch((e=>{r(e)}))}));return this.cache.set(t,{lastUsed:this.counter++,data:n}),n}))}getDirectory(e,t,r,n){return i(this,null,(function*(){const o=`${e.getKey()}|${n.etag||""}|${t}|${r}`,s=this.cache.get(o);if(s)return s.lastUsed=this.counter++,yield s.data;const a=new Promise(((o,s)=>{(function(e,t,r,n,o){return i(this,null,(function*(){const i=yield e.getBytes(r,n,void 0,o.etag),s=ne(yield t(i.data,o.internalCompression));if(0===s.length)throw new Error("Empty directory is invalid");return s}))})(e,this.decompress,t,r,n).then((e=>{o(e),this.prune()})).catch((e=>{s(e)}))}));return this.cache.set(o,{lastUsed:this.counter++,data:a}),a}))}getArrayBuffer(e,t,r,n){return i(this,null,(function*(){const i=`${e.getKey()}|${n.etag||""}|${t}|${r}`,o=this.cache.get(i);if(o)return o.lastUsed=this.counter++,yield o.data;const s=new Promise(((o,s)=>{e.getBytes(t,r,void 0,n.etag).then((e=>{o(e.data),this.cache.has(i),this.prune()})).catch((e=>{s(e)}))}));return this.cache.set(i,{lastUsed:this.counter++,data:s}),s}))}prune(){if(this.cache.size>=this.maxCacheEntries){let e,t=1/0;this.cache.forEach(((r,n)=>{r.lastUsed<t&&(t=r.lastUsed,e=n)})),e&&this.cache.delete(e)}}invalidate(e){return i(this,null,(function*(){const t=e.getKey();if(this.invalidations.get(t))return yield this.invalidations.get(t);this.cache.delete(e.getKey());const r=new Promise(((r,n)=>{this.getHeader(e).then((e=>{r(),this.invalidations.delete(t)})).catch((e=>{n(e)}))}));this.invalidations.set(t,r)}))}},se=class{constructor(e,t,r){this.source="string"==typeof e?new te(e):e,this.decompress=r||Y,this.cache=t||new oe}getHeader(){return i(this,null,(function*(){return yield this.cache.getHeader(this.source)}))}getZxyAttempt(e,t,r,o){return i(this,null,(function*(){const i=function(e,t,r){if(e>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(t>n(2,e)-1||r>n(2,e)-1)throw Error("tile x/y outside zoom level bounds");const i=X[e];let o=0,s=0,a=0;const c=[t,r];let l=n(2,e)/2;for(;l>0;)o=(c[0]&l)>0?1:0,s=(c[1]&l)>0?1:0,a+=l*l*(3*o^s),Q(l,c,o,s),l/=2;return i+a}(e,t,r),s=yield this.cache.getHeader(this.source);if(s.specVersion<3)return F.getZxy(s,this.source,this.cache,e,t,r,o);if(e<s.minZoom||e>s.maxZoom)return;let a=s.rootDirectoryOffset,c=s.rootDirectoryLength;for(let e=0;e<=3;e++){const e=ee(yield this.cache.getDirectory(this.source,a,c,s),i);if(!e)return;if(e.runLength>0){const t=yield this.source.getBytes(s.tileDataOffset+e.offset,e.length,o,s.etag);return{data:yield this.decompress(t.data,s.tileCompression),cacheControl:t.cacheControl,expires:t.expires}}a=s.leafDirectoryOffset+e.offset,c=e.length}throw Error("Maximum directory depth exceeded")}))}getZxy(e,t,r,n){return i(this,null,(function*(){try{return yield this.getZxyAttempt(e,t,r,n)}catch(i){if(i instanceof ie)return this.cache.invalidate(this.source),yield this.getZxyAttempt(e,t,r,n);throw i}}))}getMetadataAttempt(){return i(this,null,(function*(){const e=yield this.cache.getHeader(this.source),t=yield this.source.getBytes(e.jsonMetadataOffset,e.jsonMetadataLength,void 0,e.etag),r=yield this.decompress(t.data,e.internalCompression),n=new TextDecoder("utf-8");return JSON.parse(n.decode(r))}))}getMetadata(){return i(this,null,(function*(){try{return yield this.getMetadataAttempt()}catch(e){if(e instanceof ie)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw e}}))}getTileJson(e){return i(this,null,(function*(){const t=yield this.getHeader(),r=yield this.getMetadata(),n=1===(i=t.tileType)?".mvt":2===i?".png":3===i?".jpg":4===i?".webp":5===i?".avif":"";var i;return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${e}/{z}/{x}/{y}${n}`],vector_layers:r.vector_layers,attribution:r.attribution,description:r.description,name:r.name,version:r.version,bounds:[t.minLon,t.minLat,t.maxLon,t.maxLat],center:[t.centerLon,t.centerLat,t.centerZoom],minzoom:t.minZoom,maxzoom:t.maxZoom}}))}},ae=r(316);let ce;const le={},ue=/^pmtiles:\/\/(.+)\/([0-9]+)\/([0-9]+)\/([0-9]+).mvt$/,fe=/\/([0-9]+)\/([0-9]+)\/([0-9]+).mvt$/;(0,ae.Bb)("map","data/protomaps-dark-style.json",{transformRequest:async(e,t)=>{let r;if(e=e.replace(/^pmtiles:\/\/http(s?)\/\//,"pmtiles://http$1://"),"Style"===t&&(ce=e),e.startsWith("pmtiles://")){const t=e.slice(10).replace(fe,"");le[t]||(le[t]=new se(new URL(e.slice(10),ce).href)),r=le[t]}if(!r)return e;if("Source"===t){const t=await r.getTileJson(e);return`data:application/json,${encodeURIComponent(JSON.stringify(t))}`}if("Tiles"===t){const[,t,r,n,i]=e.match(ue),o=await le[t].getZxy(Number(r),Number(n),Number(i)),s=o?.data??new ArrayBuffer(0),a=URL.createObjectURL(new Blob([s]));return window.setTimeout((()=>URL.revokeObjectURL(a)),1e4),a}return e}})}},e=>{e(e.s=3504)}]);
//# sourceMappingURL=pmtiles.js.map